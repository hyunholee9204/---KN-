<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>대출 이자율 계산</title>
    <link rel="stylesheet" href="/css/l/calculate.css">
</head>
<body>
<div class="header">
    <div class="header-left" onclick="goToMain()">
        KN금융</div>
    <div class="nav-wrapper">
        <div class="nav-menu">
            <a href="/asset">자산 관리</a>
            <a href="/loans">대출 관리</a>
            <a href="/target">목표 달성 트래킹</a>
            <a href="/education/guide">교육 및 정보</a>
            <a href="/notice">공지사항</a>
            <a href="/inquiry">고객센터</a>
        </div>
    </div>
</div>

<div class="container">
    <div class="sidebar">
        <button onclick="location.href='/loans'">대출 현황</button>
        <button onclick="location.href='/loans/schedule'">대출 상환 일정</button>
        <button onclick="location.href='/loans/calculate'">이자율 계산</button>
    </div>

    <div class="content">
        <h2>📊 대출 이자율 계산기</h2>
        <form th:action="@{/loans/calculate}" method="post">

            <!-- 상환 방식 -->
            <label>상환 방식</label>
            <div class="button-group">
                <button type="button" class="select-button active" data-value="equalPrincipalInterest">원리금 균등</button>
                <button type="button" class="select-button" data-value="equalPrincipal">원금 균등</button>
                <button type="button" class="select-button" data-value="lumpSum">원금만기 일시상환</button>
            </div>
            <input type="hidden" name="method" id="repaymentMethod" value="equalPrincipalInterest">

            <!-- 대출 금액 -->
            <label>대출 금액 (만원)</label>
            <input type="number" name="principal" id="principal" min="1" placeholder="금액 입력" required>
            <div class="button-group">
                <button type="button" class="select-button" data-amount="100">+10만</button>
                <button type="button" class="select-button" data-amount="500">+50만</button>
                <button type="button" class="select-button" data-amount="1000">+1천만</button>
                <button type="button" class="select-button" data-amount="3000">+3천만</button>
                <button type="button" class="select-button" data-amount="5000">+5천만</button>
                <button type="button" class="select-button" data-amount="10000">+1억</button>
            </div>

            <!-- 이자율 -->
            <label>연 이자율 (%)</label>
            <input type="number" name="annualRate" id="annualRate" step="0.1" required>
            <div class="button-group">
                <button type="button" class="select-button rate-button" data-rate="3">3%</button>
                <button type="button" class="select-button rate-button" data-rate="5">5%</button>
                <button type="button" class="select-button rate-button" data-rate="7">7%</button>
                <button type="button" class="select-button rate-button" data-rate="10">10%</button>
                <button type="button" class="select-button rate-button" data-rate="15">15%</button>
            </div>

            <!-- 대출 기간 -->
            <label>대출 기간 (개월)</label>
            <input type="number" name="periodMonths" id="periodMonths" min="1" placeholder="예: 12" required>
            <div class="button-group">
                <button type="button" class="select-button" data-period="12">1년</button>
                <button type="button" class="select-button" data-period="24">2년</button>
                <button type="button" class="select-button" data-period="36">3년</button>
                <button type="button" class="select-button" data-period="60">5년</button>
                <button type="button" class="select-button" data-period="120">10년</button>
            </div>

            <!-- 거치 기간 -->
            <label>거치 기간 (개월)</label>
            <input type="number" name="gracePeriod" id="gracePeriod" value="0">
            <div class="button-group">
                <button type="button" class="select-button" data-grace="12">1년</button>
                <button type="button" class="select-button" data-grace="24">2년</button>
                <button type="button" class="select-button" data-grace="36">3년</button>
            </div>

            <!-- 계산 버튼 -->
            <button type="submit" class="submit-button">계산하기</button>
        </form>
        <br>

        <!-- 계산 결과 -->
        <div th:if="${totalRepayment != null}"
             th:with="isFullGrace=${repaymentMonths == 0}, isLump=${method == 'lumpSum'}"
             class="result-box"
             style="margin-top:24px;padding:20px;border:1px solid #e5e7eb;border-radius:12px;background:#fafafa">

            <h3 style="margin-top:0">계산 결과</h3>


            <!-- (A) 만기 일시 구조: 원금만기일시상환 또는 거치기간=전체기간 -->
            <div th:if="${isLump or isFullGrace}">
                <p>
                    월 이자:
                    <strong th:text="${#numbers.formatInteger(monthlyPayment, 0, 'COMMA')} + ' 원'">0 원</strong>
                </p>
                <p>
                    만기 시 원금 일시상환:
                    <strong th:text="${#numbers.formatInteger(principalAmount, 0, 'COMMA')} + ' 원'">0 원</strong>
                </p>
            </div>

            <!-- (B) 일반적인 경우: 거치 有/無 로 나눠서 표시 -->
            <div th:unless="${isLump or isFullGrace}">
                <!-- 거치기간이 있는 경우 -->
                <div th:if="${gracePeriod > 0}">
                    <p>
                        거치기간 월 납부액(이자):
                        <strong th:text="${#numbers.formatInteger(monthlyPayment, 0, 'COMMA')} + ' 원'">0 원</strong>
                    </p>
                    <!-- 거치 종료 후 첫 달 상환액(원리금/원금 균등일 때만 노출) -->
                    <p th:if="${postGraceMonthly != null}">
                        거치 종료 후 월 상환액:
                        <strong th:text="${#numbers.formatInteger(postGraceMonthly, 0, 'COMMA')} + ' 원'">0 원</strong>
                    </p>
                </div>

                <!-- 거치기간이 없는 경우 -->
                <div th:unless="${gracePeriod > 0}">
                    <p>
                        월 상환액:
                        <strong th:text="${#numbers.formatInteger(monthlyPayment, 0, 'COMMA')} + ' 원'">0 원</strong>
                    </p>
                </div>
            </div>

            <hr style="margin:16px 0">

            <p>
                총 상환액:
                <strong th:text="${#numbers.formatInteger(totalRepayment, 0, 'COMMA')} + ' 원'">0 원</strong>
            </p>
            <p>
                총 이자액:
                <strong th:text="${#numbers.formatInteger(totalInterest, 0, 'COMMA')} + ' 원'">0 원</strong>
            </p>

            <p style="color:#6b7280;margin-top:8px" th:if="${method != null}">
                상환 방식:
                <span th:switch="${method}">
                <span th:case="'equalPrincipalInterest'">원리금균등</span>
                <span th:case="'equalPrincipal'">원금균등</span>
                <span th:case="'lumpSum'">만기일시상환</span>
                <span th:case="*">알 수 없음</span>
                </span>
            </p>

        </div>



        <br>
        <div class="loan-info-box">
            <h3>📌 대출이자 계산기 안내사항</h3><br>

            <div class="info-item">
                <strong>원리금균등상환</strong>
                <p>가장 일반적인 상환 방법으로, 원금과 이자를 합한 상환금액이 매달 동일합니다.</p>
            </div><br>

            <div class="info-item">
                <strong>원금만기일시상환</strong>
                <p>대출기간동안 매달 이자만 상환하고, 대출 만기일에 원금을 일시상환 합니다.</p>
            </div><br>

            <div class="info-item">
                <strong>원금균등상환</strong>
                <p>매달 원금을 동일하게 상환하므로, 이자는 매달 줄어들게 됩니다. 단, 매달 이자가 다르므로 원금+이자를 합한 상환금액도 매달 달라집니다.</p>
            </div><br>

            <div class="info-item">
                <strong>거치기간</strong>
                <p>거치기간동안 이자만 납부하고, 거치기간이 끝나면 원금+이자를 납부하게 됩니다. 따라서 원리금/원금 균등상환에만 적용됩니다.</p>
            </div><br>

            <div class="info-item">
                <strong>오차 가능성 안내</strong>
                <p>본 대출금 상환 계산기는 월 단위로 계산 한 것이므로, 실제 대출 시작 일자에 따른 일할 계산에 따른 약간의 차이는 있을 수 있습니다.</p>
            </div>
        </div>

    </div>
</div>

<script>
    function goToMain() {
        window.location.href = "/main";
    }

    // 상환방식 선택
    document.querySelectorAll(".select-button[data-value]").forEach(btn => {
        btn.addEventListener("click", () => {
            document.querySelectorAll(".select-button[data-value]").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            document.getElementById("repaymentMethod").value = btn.dataset.value;
        });
    });

    // 대출금액 증가 버튼
    document.querySelectorAll(".select-button[data-amount]").forEach(btn => {
        btn.addEventListener("click", () => {
            const input = document.getElementById("principal");
            input.value = parseInt(input.value || 0) + parseInt(btn.dataset.amount);
        });
    });

    // 이자율 선택
    document.querySelectorAll(".rate-button").forEach(btn => {
        btn.addEventListener("click", () => {
            document.getElementById("annualRate").value = btn.dataset.rate;
        });
    });

    // 대출기간 선택
    document.querySelectorAll(".select-button[data-period]").forEach(btn => {
        btn.addEventListener("click", () => {
            document.getElementById("periodMonths").value = btn.dataset.period;
        });
    });

    // 거치기간 선택
    document.querySelectorAll(".select-button[data-grace]").forEach(btn => {
        btn.addEventListener("click", () => {
            document.getElementById("gracePeriod").value = btn.dataset.grace;
        });
    });
</script>
</body>
</html>
