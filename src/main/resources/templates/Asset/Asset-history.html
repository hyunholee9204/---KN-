<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ì›”ë³„ ìì‚° ë³€ë™ ë‚´ì—­</title>
    <link rel="stylesheet" href="/css/a/a-status.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .chart-container {
            max-width: 800px;
            margin: 20px auto;
            background: #fff;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        #toggleChartBtn {
            display: inline-block;
            background-color: #0D47A1;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 18px;
            margin-top: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s ease-in-out;
        }

        #toggleChartBtn:hover {
            background-color: #1565C0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
        }

        th, td {
            text-align: center;
            padding: 14px;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f3f4f6;
            font-weight: bold;
        }

        h2 {
            margin-bottom: 10px;
        }

        .asset-box {
            padding: 30px;
        }
    </style>
</head>
<body>

<!-- âœ… ìƒë‹¨ í—¤ë” -->
<div class="header">
    <div class="header-left" onclick="goToMain()">KNê¸ˆìœµ</div>
    <div class="nav-wrapper">
        <div class="nav-menu">
            <a href="/asset">ìì‚° ê´€ë¦¬</a>
            <a href="/loans">ëŒ€ì¶œ ê´€ë¦¬</a>
            <a href="/target">ëª©í‘œ ë‹¬ì„± íŠ¸ë˜í‚¹</a>
            <a href="/education/guide">êµìœ¡ ë° ì •ë³´</a>
            <a href="/notice">ê³µì§€ì‚¬í•­</a>
            <a href="/inquiry">ê³ ê°ì„¼í„°</a>
        </div>
    </div>
</div>

<!-- âœ… ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
<div class="container">
    <div class="sidebar">
        <button onclick="location.href='/asset/status'">ìì‚° í˜„í™©</button>
        <button onclick="location.href='/asset/transaction/all'">ìì‚° ë‚´ì—­ ì¡°íšŒ</button>
        <button class="active">ì›”ë³„ ë³€ë™ ë‚´ì—­</button>
        <button onclick="location.href='/asset/goal'">ëª©í‘œ ë‹¬ì„±ìš© ìì‚° ë“±ë¡</button>
    </div>

    <div class="content">
        <div class="asset-box">
            <h2 th:text="${userName} + 'ë‹˜ì˜ ì›”ë³„ ìì‚° ë³€ë™ ë‚´ì—­'"></h2>
            <p>ğŸ“Š ì•„ë˜ ê·¸ë˜í”„ëŠ” ì›”ë³„ ìì‚° ì´ì•¡ ë³€ë™ì„ ì‹œê°í™”í•œ ê·¸ë˜í”„ì…ë‹ˆë‹¤.</p>

            <div style="width: 80%; max-width: 900px; margin: 0 auto;">
                <canvas id="monthlyChart" width="900" height="400"></canvas>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button id="toggleChartBtn" class="btn btn-primary">ê·¸ë˜í”„ ì „í™˜ (ë§‰ëŒ€)</button>
            </div>


            <h3 style="margin-top: 40px;">ğŸ“… ì›”ë³„ ìì‚°</h3>
            <table>
                <thead>
                <tr>
                    <th>ê¸°ë¡ ì›”</th>
                    <th>ì´ ìì‚° ê¸ˆì•¡</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${monthlyHistory}">
                    <td th:text="${#temporals.format(item.recordMonth, 'yyyyë…„ MMì›”')}"></td>
                    <td th:text="${#numbers.formatInteger(item.totalAmount, 3, 'COMMA')} + 'ì›'"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script th:inline="javascript">
    const labels = /*[[${months}]]*/ [];
    const data = /*[[${totals}]]*/ [];

    let currentType = 'line';
    const canvas = document.getElementById('monthlyChart');
    const ctx = canvas.getContext('2d');

    // âœ… ê³µí†µ ìŠ¤íƒ€ì¼
    const datasetConfig = {
    label: 'ì›”ë³„ ìì‚° ì´ì•¡ (ì›)',
    data: data,
    borderColor: '#7B1FA2',
    backgroundColor: 'rgba(233, 30, 99, 0.2)',
    fill: true,
    tension: 0.4,
    borderWidth: 3,
    pointRadius: 5,
    pointBackgroundColor: '#9C27B0'
    };

    const chartOptions = {
    responsive: false,
    maintainAspectRatio: false,
    plugins: {
        legend: { display: true, position: 'top' },
        tooltip: {
            callbacks: {
                label: function(context) {
                    return context.parsed.y.toLocaleString() + 'ì›';
                }
            }
        }
    },
    scales: {
        y: {
            beginAtZero: true,
            ticks: {
                stepSize: 1500000, // âœ… ëˆˆê¸ˆ ê°„ê²©
                callback: value => value.toLocaleString() + 'ì›'
            },
            title: {
                display: true,
                text: 'ìì‚° ê¸ˆì•¡ (ì›)',
                font: { size: 14, weight: 'bold' }
            }
        },
        x: {
            title: {
                display: true,
                text: 'ì›”ë³„',
                font: { size: 14, weight: 'bold' }
            }
        }
    }
};


    // âœ… ì´ˆê¸° ê·¸ë˜í”„
    let chart = new Chart(ctx, {
        type: currentType,
        data: {
            labels: labels,
            datasets: [datasetConfig]
        },
        options: chartOptions
    });

    // âœ… ì „í™˜ ë²„íŠ¼ ì´ë²¤íŠ¸
    document.getElementById('toggleChartBtn').addEventListener('click', () => {
        const canvas = document.getElementById('monthlyChart');
        currentType = currentType === 'line' ? 'bar' : 'line';

        // âœ… ê·¸ë˜í”„ ë¦¬ì…‹ ì‹œ ìº”ë²„ìŠ¤ í¬ê¸°ë„ í•¨ê»˜ ì´ˆê¸°í™”
        chart.destroy();
        canvas.width = 900;   // ê³ ì • í¬ê¸° ì¬ì„¤ì •
        canvas.height = 400;

        chart = new Chart(ctx, {
            type: currentType,
            data: {
                labels: labels,
                datasets: [datasetConfig]
            },
            options: chartOptions
        });

        document.getElementById('toggleChartBtn').textContent =
            currentType === 'line' ? 'ê·¸ë˜í”„ ì „í™˜ (ë§‰ëŒ€)' : 'ê·¸ë˜í”„ ì „í™˜ (ì„ )';
    });
</script>

<script>
    function goToMain() {
        window.location.href = "/main";
    }
</script>

</body>
</html>
