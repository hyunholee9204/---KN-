<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>KN금융</title>
  <link rel="stylesheet" href="/css/style1.css">

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
</head>
<body>
<div class="header-container">
  <div class="header-left" onclick="goToMain()">
    <img src="/img/logo.png" alt="로고" class="logo-icon">
    KN금융</div>

  <div class="header-right">
    <!-- 로그인 X -->
    <span th:if="${session.loginUser == null}">
    <a href="/signup" class="header-link">
      <img src="/img/add.png" alt="회원가입" class="header-icon"> 회원가입
    </a>
    <a href="/login" class="header-link">
      <img src="/img/login.png" alt="로그인" class="header-icon"> 로그인
    </a>
  </span>

    <!-- 로그인 O -->
    <span th:if="${session.loginUser != null}" class="user-menu">
    <span th:if="${session.loginUser != null}"
          th:text="${session.loginUser.name}">사용자</span>님 ▼

      <!-- ▼ 드롭다운 메뉴 -->
    <div class="dropdown">
      <a href="/logout">
        <img src="/img/logout.png" alt="로그아웃" class="header-icon"> 로그아웃
      </a>

      <form action="/user/delete" method="post"
            onsubmit="return confirm('정말 회원 탈퇴를 진행하시겠습니까?');">
        <button type="submit" class="delete-btn">
          <img src="/img/delete.png" alt="회원탈퇴" class="header-icon"> 회원 탈퇴
        </button>
      </form>
    </div>
  </span>
  </div>
</div>

<div class="menu-bar">
  <!-- 메뉴 구성 생략 없이 유지 -->
  <div class="dropdown">
    <button onclick="location.href='/asset'">자산 관리</button>
    <div class="dropdown-content">
      <a href="/asset/status">자산 현황</a>
      <a href="/asset/transaction/all">자산 내역 조회</a>
      <a href="/asset/history">월별 자산 변동</a>
      <a href="/asset/goal">목표 달성용 자산 등록</a>
    </div>
  </div>
  <div class="dropdown">
    <button onclick="location.href='/loans'">대출 관리</button>
    <div class="dropdown-content">
      <a href="/loans">대출 현황</a>
      <a href="/loans/schedule">대출 상환 일정</a>
      <a href="/loans/calculate">이자율 계산</a>
    </div>
  </div>
  <div class="dropdown">
    <button onclick="location.href='/target'">목표 달성 트래킹</button>
    <div class="dropdown-content">
      <a href="/target">목표 등록</a>
      <a href="/target/progress">진행 상황</a>

    </div>
  </div>
  <div class="dropdown">
    <button onclick="location.href='/education/guide'">교육 및 정보 제공</button>
    <div class="dropdown-content">
      <a href="/education/guide">금융 교육</a>
      <a href="/finance/info">금융 정보</a>
    </div>
  </div>
  <div class="dropdown">
    <button onclick="location.href='/notice'">공지사항</button>
    <div class="dropdown-content">
      <a href="/notice">공지사항</a>
      <a href="/notice/updates">업데이트 내역</a>
    </div>
  </div>
  <div class="dropdown">
    <button onclick="location.href='/inquiry'">고객센터</button>
    <div class="dropdown-content">
      <a href="/inquiry/faq">FAQ</a>
      <a href="/inquiry/form">문의하기</a>
      <a href="/inquiry/my">내 문의내역</a>
      <a href="/inquiry/guide">이용 가이드</a>
    </div>
  </div>
</div>

<div class="welcome-section">
  <div class="welcome-text">
    <br><h2>KN금융에 오신 것을 환영합니다!</h2><br>
    <p>KN금융은 자산 관리, 대출 정보, 목표 설정 및 금융 교육 콘텐츠를 통한 서비스를 제공합니다.</p>
    <p>사용자 맞춤형 금융 데이터를 기반으로 효율적인 금융 생활을 지원해드리고 있습니다.</p><br>
  </div>

  <!-- 기존 기능 설명 카드 -->
  <section class="features-section">
    <p class="features-title">KN금융은 이렇게 도와드립니다.</p>
    <div class="features-container">
      <div class="feature-box">
        <img src="/img/money-bag.png" alt="자산관리">
        <h3>자산 현황 통합 관리</h3>
        <p>사용자의 자산을 등록하고, 자산의 변동 내역을 월별 그래프와 함께 확인할 수 있습니다.</p>
      </div>
      <div class="feature-box">
        <img src="/img/pay.png" alt="대출관리">
        <h3>효율적인 대출 계획</h3>
        <p>대출 정보를 등록하고, 상환 방식(원리금균등·원금균등·만기일시)에 따른 상환 일정과 이자율을 계산할 수 있습니다.</p>
      </div>
      <div class="feature-box">
        <img src="/img/checklist.png" alt="목표트래킹">
        <h3>개인 맞춤 목표 트래킹</h3>
        <p>저축 목표를 설정하고, 달성률과 남은 기간을 자동으로 계산하여 시각적으로 확인할 수 있습니다.</p>
      </div>
      <div class="feature-box">
        <img src="/img/list.png" alt="교육 및 정보 제공">
        <h3>교육 및 정보 제공</h3>
        <p>예산 관리, 저축, 이자 개념 등 금융 관련 교육 콘텐츠를 통해 재무 지식을 높일 수 있습니다.</p>
      </div>
    </div>
  </section>
  <section class="calendar">
    <!-- 대시보드: 캘린더 + 요약 -->
    <div class="main-dashboard-grid">
      <div class="calendar-panel">
        <h3>📅 금융 일정</h3>
        <div id="calendar"></div>
      </div>

      <div class="summary-panel" th:if="${session.loginUser != null}">
        <h3>📊 나의 금융 요약</h3>
        <ul>
          <li>총 자산:
            <span th:text="${#numbers.formatInteger(assetAmount, 3, 'COMMA')} + '원'">0원</span>
          </li>
          <li>총 대출:
            <span th:text="${#numbers.formatInteger(loanAmount, 3, 'COMMA')} + '원'">0원</span>
          </li>

          <!-- ✅ 목표 여러 개 표시하는 부분 (새로 추가) -->
          <li th:each="t : ${targetList}">
            목표: <span th:text="${t}">예시 목표 (~2025.12.31) - 60%</span>
          </li>
        </ul>
      </div>
    </div>
  </section>
  <!-- 하단 공지/빠른이동/고객센터 생략 없이 유지 -->
  <div class="dashboard-bottom">
    <div class="bottom-left">
      <h2>📢 최근 공지사항</h2><br>
      <ul>
        <li><a href="/notice/3">[공지] KN금융 시스템 점검 안내</a><span>2025.10.16</span></li>
        <li><a href="/notice/2">[공지] 비밀번호 변경 주기 안내</a><span>2025.10.16</span></li>
        <li><a href="/asset/history">[신규기능] 월별 자산 변동 내역 기능 오픈</a><span>2025.10.15</span></li>
      </ul>
      <a href="/notice" class="more-link">+ 전체 보기</a>
    </div>
    <div class="bottom-center">
      <h2>🔗 빠른 이동</h2><br>
      <div class="quick-links">
        <a href="/asset/status">📊 자산 관리</a>
        <a href="/loans/register">💰 대출 관리</a>
        <a href="/target">🎯 목표 트래킹</a>
        <a href="/education/guide">📘 교육 및 정보</a>
        <a href="/notice">📢 공지사항</a>
        <a href="/inquiry/form">📝 문의하기</a>
      </div>
    </div>
    <div class="bottom-right">
      <h2>📞 고객센터</h2>
      <br>
      <h3>T. 1234-5678 </h3><br>
      평일 09:30 ~ 17:30, 주말 및 공휴일 10:00 ~ 18:00
      <p>
        <a href="/inquiry/form" class="customer-center">1:1 문의하기</a> |
        <a href="/inquiry/faq" class="customer-center">FAQ 보기</a>
      </p>
    </div>
  </div>
  <footer>
    <p> 주소 : 경기도 용인시 기흥구 강남로 40(구갈동 111) </p>
    <p>Copyright(c) KN금융. All rights reserved.</p>
    <p>
      문의:<a href="mailto:support@kangnamfinance.com">kangnam:support@kangnamfinance.com</a>
    </p>
    <p>
      <a href="/terms">이용약관</a> |
      <a href="/privacy">개인정보 처리방침</a>
    </p>
  </footer>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function() {
  var calendarEl = document.getElementById('calendar');

  var calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    locale: 'ko',
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: ''
    },
    events: '/target/calendar-events',  // 👉 여기서 목표 데이터를 가져옴
    eventDisplay: 'block',     // 막대형 표시
    eventColor: '#4CAF50',     // 색상 (녹색 예시)
    eventTextColor: '#fff'     // 글자색
  });

  calendar.render();
});
</script>
<script>
  function goToMain() {
      window.location.href = "/main";
  }
</script>
<script>
  // 페이지 로드 후 팝업 표시 여부 확인
  window.onload = function() {
    const now = new Date();
    const hideUntil = localStorage.getItem("popupHideUntil");

    // 이미 "오늘/일주일 동안 보지 않기" 선택한 경우 → 첫번째 팝업만 숨김
    if (!hideUntil || new Date(hideUntil) <= now) {

      // == 첫 번째 팝업 ==
      const width = 600;
      const height = 500;
      const left = (window.screen.width - width) / 2 - 300;
      const top = (window.screen.height - height) / 2;

      window.open(
        "/popup.html",
        "adPopup",
        `width=${width},height=${height},left=${left},top=${top},resizable=no`
      );
    }

    // == 두 번째 팝업 (UI 개선 안내) ==
    const uiWidth = 600;
    const uiHeight = 500;
    const uiLeft = (window.screen.width - uiWidth) / 2 + 300;  // 오른쪽에 띄우기
    const uiTop = (window.screen.height - uiHeight) / 2;

    window.open(
      "/popup-ui.html",
      "uiPopup",
      `width=${uiWidth},height=${uiHeight},left=${uiLeft},top=${uiTop},resizable=no`
    );
  };
</script>
</body>
</html>
